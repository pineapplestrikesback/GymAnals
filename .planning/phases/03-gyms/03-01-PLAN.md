---
phase: 03-gyms
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - GymAnals/Models/Enums/GymColor.swift
  - GymAnals/Models/Core/Gym.swift
  - GymAnals/Services/Seed/GymSeedService.swift
  - GymAnals/App/GymAnalsApp.swift
autonomous: true

must_haves:
  truths:
    - "Gym model has colorTag property that persists across app restarts"
    - "Gym model has isDefault flag to mark system default gym"
    - "Default Gym is automatically created on first launch"
    - "Default Gym cannot be deleted (isDefault == true)"
  artifacts:
    - path: "GymAnals/Models/Enums/GymColor.swift"
      provides: "Predefined color palette enum for gym tags"
      contains: "enum GymColor"
    - path: "GymAnals/Models/Core/Gym.swift"
      provides: "Updated Gym model with color, default flag, lastUsed"
      contains: "colorTagRaw"
    - path: "GymAnals/Services/Seed/GymSeedService.swift"
      provides: "Default gym creation on first launch"
      contains: "seedIfNeeded"
  key_links:
    - from: "GymAnals/Models/Core/Gym.swift"
      to: "GymAnals/Models/Enums/GymColor.swift"
      via: "colorTag computed property"
      pattern: "GymColor\\(rawValue:"
    - from: "GymAnals/App/GymAnalsApp.swift"
      to: "GymAnals/Services/Seed/GymSeedService.swift"
      via: "seedIfNeeded call in init"
      pattern: "GymSeedService\\.seedIfNeeded"
---

<objective>
Add gym color tags, default gym flag, and automatic default gym seeding.

Purpose: Enable visual gym identification with colors and ensure every user has a "Default Gym" that cannot be deleted, following the established seed service pattern from Phase 2.

Output: Updated Gym model, GymColor enum, GymSeedService, and app initialization.
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-gyms/03-CONTEXT.md
@.planning/phases/03-gyms/03-RESEARCH.md

# Existing patterns to follow
@GymAnals/Models/Core/Gym.swift
@GymAnals/Models/Core/Variant.swift (rawValue storage pattern)
@GymAnals/Services/Seed/ExerciseSeedService.swift (seed service pattern)
@GymAnals/App/GymAnalsApp.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GymColor enum and update Gym model</name>
  <files>
    GymAnals/Models/Enums/GymColor.swift
    GymAnals/Models/Core/Gym.swift
  </files>
  <action>
Create GymColor enum at GymAnals/Models/Enums/GymColor.swift:
- Cases: red, orange, yellow, green, blue, purple, pink, gray
- Conforms to: String, CaseIterable, Codable
- Computed property `color: Color` that returns the SwiftUI Color for each case

Update Gym.swift to add:
- `isDefault: Bool = false` - marks system default gym (cannot be deleted)
- `colorTagRaw: String = GymColor.blue.rawValue` - stores color as rawValue
- `lastUsedDate: Date?` - for ordering by most recently used
- Computed property `colorTag: GymColor` with get/set that wraps colorTagRaw (follow Variant.primaryMuscleGroup pattern)
- Remove the existing `location: String?` property (per CONTEXT.md: "Gyms have name only")
- Update init to include `colorTag: GymColor = .blue` and `isDefault: Bool = false` parameters

Why rawValue storage: SwiftData requires primitive types for predicate filtering (established pattern from Phase 2-01).
  </action>
  <verify>
Build succeeds with `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 16' build`
  </verify>
  <done>
GymColor enum exists with 8 color cases, Gym model has isDefault, colorTagRaw, lastUsedDate properties with computed colorTag accessor.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GymSeedService and wire to app initialization</name>
  <files>
    GymAnals/Services/Seed/GymSeedService.swift
    GymAnals/App/GymAnalsApp.swift
  </files>
  <action>
Create GymSeedService.swift at GymAnals/Services/Seed/:
- @MainActor final class GymSeedService
- Static method `seedIfNeeded(context: ModelContext)`:
  1. Check if any gyms exist via fetchCount
  2. If count == 0, create Default Gym:
     - name: "Default Gym"
     - colorTag: .blue
     - isDefault: true
  3. Save context and print success/failure message

Follow ExerciseSeedService pattern exactly for consistency.

Update GymAnalsApp.swift init():
- Add GymSeedService.seedIfNeeded(context: container.mainContext) call
- Place it BEFORE ExerciseSeedService call (gyms should exist before exercises, though not strictly required for Phase 3)
  </action>
  <verify>
1. Build succeeds
2. Run app in simulator - check console for "GymSeedService: Created default gym" on first launch
3. Second launch should not recreate (no duplicate default gyms)
  </verify>
  <done>
GymSeedService creates Default Gym on first launch, app initializes both GymSeedService and ExerciseSeedService.
  </done>
</task>

</tasks>

<verification>
1. Build the app: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 16' build`
2. Run in simulator and verify console shows gym seed message
3. Verify Gym model compiles with new properties
4. Verify GymColor enum has all 8 colors
</verification>

<success_criteria>
- GymColor enum with 8 predefined colors exists
- Gym model has isDefault, colorTagRaw (with computed colorTag), and lastUsedDate
- GymSeedService creates "Default Gym" on first launch
- App builds and runs without errors
- Default Gym is marked as isDefault = true
</success_criteria>

<output>
After completion, create `.planning/phases/03-gyms/03-01-SUMMARY.md`
</output>
