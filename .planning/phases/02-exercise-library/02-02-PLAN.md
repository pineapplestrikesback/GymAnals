---
phase: 02-exercise-library
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - GymAnals/Resources/exercises.json
  - GymAnals/Services/Seed/ExerciseSeedService.swift
  - GymAnals/Services/Seed/SeedData.swift
  - GymAnals/App/GymAnalsApp.swift
autonomous: true

must_haves:
  truths:
    - "App launches with 100+ pre-populated exercises"
    - "Each exercise has weighted muscle contributions"
    - "Seed data only loads on first launch (not every launch)"
    - "JSON data includes movements, variants, equipment, and exercises"
  artifacts:
    - path: "GymAnals/Resources/exercises.json"
      provides: "Pre-populated exercise data with muscle weights"
      min_lines: 500
    - path: "GymAnals/Services/Seed/ExerciseSeedService.swift"
      provides: "First-launch data loading service"
      contains: "func seedIfNeeded"
    - path: "GymAnals/Services/Seed/SeedData.swift"
      provides: "Decodable structs for JSON parsing"
      contains: "struct SeedData: Decodable"
  key_links:
    - from: "GymAnalsApp.swift"
      to: "ExerciseSeedService.swift"
      via: "modelContainer onSetup callback"
      pattern: "seedIfNeeded"
    - from: "ExerciseSeedService.swift"
      to: "exercises.json"
      via: "Bundle.main.url parsing"
      pattern: "Bundle.main.url.*exercises.*json"
---

<objective>
Create JSON seed data infrastructure and populate app with 100+ exercises at first launch.

Purpose: Deliver EXER-01 requirement (pre-populated exercise library with 200+ exercises) - starting with 100+ solid exercises, expandable later
Output: exercises.json with seed data, ExerciseSeedService for first-launch loading, integrated into app lifecycle
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-exercise-library/02-CONTEXT.md
@.planning/phases/02-exercise-library/02-RESEARCH.md

@GymAnals/Models/Core/Movement.swift
@GymAnals/Models/Core/Variant.swift
@GymAnals/Models/Core/Equipment.swift
@GymAnals/Models/Core/Exercise.swift
@GymAnals/Models/Core/VariantMuscle.swift
@GymAnals/Models/Enums/Muscle.swift
@GymAnals/Models/Enums/MuscleGroup.swift
@GymAnals/App/GymAnalsApp.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SeedData decodable structs</name>
  <files>GymAnals/Services/Seed/SeedData.swift</files>
  <action>
Create Decodable structs matching the JSON schema from CONTEXT.md:

```swift
import Foundation

struct SeedData: Decodable {
    let equipment: [SeedEquipment]
    let movements: [SeedMovement]
}

struct SeedEquipment: Decodable {
    let name: String
}

struct SeedMovement: Decodable {
    let name: String
    let exerciseType: Int  // Maps to ExerciseType.rawValue
    let variants: [SeedVariant]
}

struct SeedVariant: Decodable {
    let name: String
    let muscleWeights: [SeedMuscleWeight]
    let equipment: [String]  // Equipment names to create Exercise combos
}

struct SeedMuscleWeight: Decodable {
    let muscle: String  // Muscle.rawValue
    let weight: Double  // 0.0 to 1.0
}
```

Use snake_case JSON keys with CodingKeys if needed, or use JSONDecoder().keyDecodingStrategy = .convertFromSnakeCase.
  </action>
  <verify>Build succeeds</verify>
  <done>SeedData structs exist and can decode the exercises.json format</done>
</task>

<task type="auto">
  <name>Task 2: Create exercises.json with 100+ exercises</name>
  <files>GymAnals/Resources/exercises.json</files>
  <action>
Create exercises.json in Resources folder with this structure. Include at minimum:

**Equipment (10+):**
Barbell, Dumbbell, Cable, Machine, Bodyweight, EZ Bar, Kettlebell, Smith Machine, Resistance Band, Trap Bar

**Movements & Variants (organized by muscle group, 20+ movements total):**

**Chest (4 movements):**
- Bench Press: Flat, Incline, Decline (chest_upper: 0.8-0.9, chest_lower: 0.3-0.7, triceps: 0.4, front_delt: 0.3)
- Fly: Flat, Incline (chest: 0.9, front_delt: 0.2)
- Push-up: Standard, Incline, Decline (similar to bench)
- Chest Dip: (chest_lower: 0.8, triceps: 0.6)

**Back (4 movements):**
- Row: Bent Over, Seated Cable, T-Bar (lats: 0.8, rhomboids: 0.5, rear_delt: 0.3, biceps: 0.4)
- Lat Pulldown/Pull-up: (lats: 0.9, biceps: 0.5, teres: 0.4)
- Deadlift: Conventional, Sumo, Romanian (erector: 0.9, glutes: 0.7, hams: 0.6)
- Shrug: (upper_traps: 0.95)

**Shoulders (3 movements):**
- Overhead Press: Seated, Standing (front_delt: 0.8, lateral_delt: 0.4, triceps: 0.4)
- Lateral Raise: (lateral_delt: 0.95)
- Face Pull/Rear Delt Fly: (rear_delt: 0.9, mid_traps: 0.5)

**Arms (4 movements):**
- Curl: Barbell, Dumbbell, Preacher, Hammer (biceps: 0.9, brachialis: 0.4-0.7)
- Tricep Extension: Overhead, Pushdown, Skullcrusher (triceps_long: 0.7-0.9, triceps_lateral: 0.5-0.8)
- Dip (arms focus): (triceps: 0.9, chest: 0.3)

**Legs (5 movements):**
- Squat: Back, Front, Goblet (quads: 0.9, glutes: 0.6)
- Leg Press: (quads: 0.9, glutes: 0.4)
- Lunge: Walking, Reverse, Bulgarian Split (quads: 0.7, glutes: 0.8)
- Leg Curl: (hamstrings: 0.95)
- Leg Extension: (quads_rectus: 0.95, quads_vastus: 0.9)
- Calf Raise: Standing, Seated (gastrocnemius: 0.9 standing, soleus: 0.9 seated)

**Core (2 movements):**
- Crunch/Situp: (abs: 0.9)
- Plank: (abs: 0.7, obliques: 0.5, erector: 0.3) - exerciseType: duration

Each variant gets combined with appropriate equipment (e.g., Bench Press + Barbell, Dumbbell, Smith Machine).

Use Muscle enum rawValues for muscle keys (e.g., "pectoralisMajorUpper" not "chest_upper").

Target: 100+ unique Exercise combinations (movement + variant + equipment).
  </action>
  <verify>JSON is valid: `python3 -c "import json; json.load(open('GymAnals/Resources/exercises.json'))"`</verify>
  <done>exercises.json exists with 100+ exercises covering all major muscle groups</done>
</task>

<task type="auto">
  <name>Task 3: Create ExerciseSeedService and integrate into app</name>
  <files>GymAnals/Services/Seed/ExerciseSeedService.swift, GymAnals/App/GymAnalsApp.swift</files>
  <action>
**ExerciseSeedService.swift:**
```swift
import Foundation
import SwiftData

@MainActor
final class ExerciseSeedService {
    static func seedIfNeeded(context: ModelContext) {
        // Check if already seeded
        let descriptor = FetchDescriptor<Movement>()
        let count = (try? context.fetchCount(descriptor)) ?? 0
        guard count == 0 else { return }

        // Load and parse JSON
        guard let url = Bundle.main.url(forResource: "exercises", withExtension: "json"),
              let data = try? Data(contentsOf: url),
              let seedData = try? JSONDecoder().decode(SeedData.self, from: data) else {
            print("Failed to load seed data")
            return
        }

        // Create Equipment
        var equipmentMap: [String: Equipment] = [:]
        for item in seedData.equipment {
            let equipment = Equipment(name: item.name, isBuiltIn: true)
            context.insert(equipment)
            equipmentMap[item.name] = equipment
        }

        // Create Movements, Variants, VariantMuscles, Exercises
        for seedMovement in seedData.movements {
            let movement = Movement(name: seedMovement.name, isBuiltIn: true)
            movement.exerciseTypeRaw = seedMovement.exerciseType
            context.insert(movement)

            for seedVariant in seedMovement.variants {
                let variant = Variant(name: seedVariant.name, isBuiltIn: true)
                variant.movement = movement
                context.insert(variant)

                // Add muscle weights
                for seedWeight in seedVariant.muscleWeights {
                    if let muscle = Muscle(rawValue: seedWeight.muscle) {
                        let vm = VariantMuscle(muscle: muscle, weight: seedWeight.weight)
                        vm.variant = variant
                        context.insert(vm)
                    }
                }

                // Set primary muscle group from first/highest weight
                if let primary = seedVariant.muscleWeights.max(by: { $0.weight < $1.weight }) {
                    variant.primaryMuscleGroupRaw = Muscle(rawValue: primary.muscle)?.group.rawValue
                }

                // Create Exercise for each equipment combo
                for equipName in seedVariant.equipment {
                    if let equipment = equipmentMap[equipName] {
                        let exercise = Exercise(variant: variant, equipment: equipment)
                        context.insert(exercise)
                    }
                }
            }
        }

        try? context.save()
        print("Seeded \(seedData.movements.count) movements")
    }
}
```

**GymAnalsApp.swift changes:**
Add to modelContainer's onSetup callback (per RESEARCH.md pattern):

Inside WindowGroup, change `.modelContainer(PersistenceController.shared.container)` to use the callback form:

```swift
.modelContainer(for: [...schema...]) { result in
    // Or use existing container and call seed after:
}
```

Actually, simpler approach - call seedIfNeeded in the App's init or in a task after container is ready. Add to GymAnalsApp:

```swift
@main
struct GymAnalsApp: App {
    let container = PersistenceController.shared.container

    init() {
        // Seed on first launch
        Task { @MainActor in
            ExerciseSeedService.seedIfNeeded(context: container.mainContext)
        }
    }

    var body: some Scene {
        WindowGroup {
            ContentView()
        }
        .modelContainer(container)
    }
}
```

Ensure exercises.json is added to the Xcode project's Copy Bundle Resources build phase (should be automatic with folder sync).
  </action>
  <verify>
1. Build succeeds
2. Run in simulator, check console for "Seeded X movements" on first launch
3. Re-launch should NOT print seeded message (already populated)
  </verify>
  <done>ExerciseSeedService seeds database on first launch only, app launches with 100+ exercises</done>
</task>

</tasks>

<verification>
1. Build succeeds: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 17' build`
2. exercises.json is valid JSON
3. App seeds data on first launch (console output)
4. App does NOT re-seed on subsequent launches
</verification>

<success_criteria>
- SeedData structs can decode exercises.json
- exercises.json contains 100+ exercises across all major muscle groups
- ExerciseSeedService seeds database on first launch only
- Pre-populated exercises have weighted muscle contributions
</success_criteria>

<output>
After completion, create `.planning/phases/02-exercise-library/02-02-SUMMARY.md`
</output>
