---
phase: 02-exercise-library
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - GymAnals/Models/Enums/ExerciseType.swift
  - GymAnals/Models/Core/Movement.swift
  - GymAnals/Models/Core/Variant.swift
autonomous: true

must_haves:
  truths:
    - "Exercise type determines logging fields (Weight & Reps, Bodyweight, Duration, etc.)"
    - "Movement has a default exercise type for its variants"
    - "Filtering by muscle group or exercise type works correctly with SwiftData predicates"
  artifacts:
    - path: "GymAnals/Models/Enums/ExerciseType.swift"
      provides: "ExerciseType enum with 8 types following Hevy model"
      contains: "enum ExerciseType"
    - path: "GymAnals/Models/Core/Movement.swift"
      provides: "Movement with exercise type support"
      contains: "exerciseTypeRaw"
    - path: "GymAnals/Models/Core/Variant.swift"
      provides: "Variant with primary muscle group for filtering"
      contains: "primaryMuscleGroupRaw"
  key_links:
    - from: "Movement.swift"
      to: "ExerciseType.swift"
      via: "stored rawValue + computed property"
      pattern: "var exerciseType: ExerciseType"
    - from: "Variant.swift"
      to: "MuscleGroup.swift"
      via: "stored rawValue + computed property"
      pattern: "var primaryMuscleGroup: MuscleGroup"
---

<objective>
Add ExerciseType enum and update models to support SwiftData predicate filtering.

Purpose: Enable proper logging field selection per exercise and fix the enum filtering limitation documented in RESEARCH.md
Output: ExerciseType enum with 8 types, Movement/Variant models updated with rawValue storage pattern
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-exercise-library/02-CONTEXT.md
@.planning/phases/02-exercise-library/02-RESEARCH.md

@GymAnals/Models/Enums/MuscleGroup.swift
@GymAnals/Models/Core/Movement.swift
@GymAnals/Models/Core/Variant.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExerciseType enum</name>
  <files>GymAnals/Models/Enums/ExerciseType.swift</files>
  <action>
Create ExerciseType enum following the Hevy model from CONTEXT.md:

```swift
enum ExerciseType: Int, CaseIterable, Codable, Identifiable {
    case weightReps = 0        // Bench Press, Curls → Reps + KG
    case bodyweightReps = 1    // Pullups, Situps → Reps only
    case weightedBodyweight = 2 // Weighted Pullups → Reps + (+KG)
    case assistedBodyweight = 3 // Assisted Pullups → Reps + (-KG)
    case duration = 4          // Planks, Yoga → Timer
    case durationWeight = 5    // Weighted Plank → KG + Time
    case distanceDuration = 6  // Running, Cycling → Time + KM
    case weightDistance = 7    // Farmers Walk → KG + KM
}
```

Include:
- `id` computed property returning rawValue as Int
- `displayName` computed property with user-friendly names
- `logFields` computed property returning array of field types this type requires (e.g., [.reps, .weight] for weightReps)
- Define LogField enum inside the file: `enum LogField: String, CaseIterable { case reps, weight, duration, distance }`
  </action>
  <verify>Build succeeds: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 17' build`</verify>
  <done>ExerciseType enum exists with 8 types, displayName, and logFields properties</done>
</task>

<task type="auto">
  <name>Task 2: Update Movement and Variant models for predicate filtering</name>
  <files>GymAnals/Models/Core/Movement.swift, GymAnals/Models/Core/Variant.swift</files>
  <action>
**Movement.swift changes:**
1. Add `var exerciseTypeRaw: Int = ExerciseType.weightReps.rawValue`
2. Add computed property:
   ```swift
   var exerciseType: ExerciseType {
       get { ExerciseType(rawValue: exerciseTypeRaw) ?? .weightReps }
       set { exerciseTypeRaw = newValue.rawValue }
   }
   ```
3. Update init to accept optional exerciseType parameter

**Variant.swift changes:**
1. Add `var primaryMuscleGroupRaw: String? = nil` (nil = not set, uses first muscleWeight's group)
2. Add computed property:
   ```swift
   var primaryMuscleGroup: MuscleGroup? {
       get {
           if let raw = primaryMuscleGroupRaw {
               return MuscleGroup(rawValue: raw)
           }
           // Fallback: derive from first muscle weight
           return muscleWeights.first?.muscle.group
       }
       set { primaryMuscleGroupRaw = newValue?.rawValue }
   }
   ```

**Why rawValue pattern:** Per RESEARCH.md, SwiftData predicates cannot filter on enum types directly. Storing rawValue allows `#Predicate { $0.primaryMuscleGroupRaw == "chest" }` to work correctly.
  </action>
  <verify>Build succeeds with no SwiftData errors</verify>
  <done>Movement has exerciseType (via rawValue), Variant has primaryMuscleGroup (via rawValue), both support SwiftData predicate filtering</done>
</task>

</tasks>

<verification>
1. `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 17' build` passes
2. ExerciseType enum has 8 cases with correct rawValue assignments
3. Movement.exerciseType computed property compiles
4. Variant.primaryMuscleGroup computed property compiles
</verification>

<success_criteria>
- ExerciseType enum defines all 8 exercise types from CONTEXT.md
- Movement model supports exercise type with SwiftData-compatible rawValue storage
- Variant model supports primary muscle group with SwiftData-compatible rawValue storage
- Build succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-exercise-library/02-01-SUMMARY.md`
</output>
