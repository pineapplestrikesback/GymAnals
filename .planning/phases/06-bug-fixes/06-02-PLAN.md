---
phase: 06-bug-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - GymAnals/Features/ExerciseLibrary/Views/MuscleWeightEditorView.swift
  - GymAnals/Features/ExerciseLibrary/ViewModels/MuscleWeightViewModel.swift
  - GymAnals/Features/ExerciseLibrary/Views/ExerciseDetailView.swift
  - GymAnals/Features/ExerciseLibrary/Views/CustomExerciseEditView.swift
autonomous: true

must_haves:
  truths:
    - "Muscle weight sliders are immediately interactive when opened from exercise detail or creation wizard"
    - "Custom exercises can have their name, equipment, movement, dimensions, notes, rest duration, and auto-start timer edited"
    - "Built-in exercises remain read-only and show no edit button"
  artifacts:
    - path: "GymAnals/Features/ExerciseLibrary/Views/MuscleWeightEditorView.swift"
      provides: "Editing mode parameter for immediate interactivity"
      contains: "startInEditMode"
    - path: "GymAnals/Features/ExerciseLibrary/Views/CustomExerciseEditView.swift"
      provides: "Form-based edit view for custom exercises"
      min_lines: 60
    - path: "GymAnals/Features/ExerciseLibrary/Views/ExerciseDetailView.swift"
      provides: "Edit button in toolbar for custom exercises"
      contains: "showingEditSheet"
  key_links:
    - from: "ExerciseDetailView.swift"
      to: "CustomExerciseEditView.swift"
      via: "sheet presentation"
      pattern: "sheet.*showingEditSheet"
    - from: "ExerciseDetailView.swift"
      to: "MuscleWeightEditorView.swift"
      via: "sheet presentation with startInEditMode"
      pattern: "startInEditMode.*true"
---

<objective>
Fix muscle weight slider discoverability and add custom exercise editing.

Purpose: Users report they "can't edit muscle weights" because sliders default to read-only mode with a hidden Edit button. Custom exercises also need a full edit flow (currently only muscle weights are editable). These fixes eliminate the two most friction-heavy UX gaps in the exercise library.
Output: Immediately-interactive muscle sliders, full custom exercise edit form.
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-bug-fixes/06-RESEARCH.md

@GymAnals/Features/ExerciseLibrary/Views/MuscleWeightEditorView.swift
@GymAnals/Features/ExerciseLibrary/ViewModels/MuscleWeightViewModel.swift
@GymAnals/Features/ExerciseLibrary/Views/ExerciseDetailView.swift
@GymAnals/Features/ExerciseLibrary/Views/ExerciseCreationWizard.swift
@GymAnals/Features/ExerciseLibrary/ViewModels/ExerciseCreationViewModel.swift
@GymAnals/Models/Core/Exercise.swift
@GymAnals/Models/Core/Movement.swift
@GymAnals/Models/Core/Equipment.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make muscle weight sliders immediately editable</name>
  <files>
    GymAnals/Features/ExerciseLibrary/Views/MuscleWeightEditorView.swift
    GymAnals/Features/ExerciseLibrary/ViewModels/MuscleWeightViewModel.swift
    GymAnals/Features/ExerciseLibrary/Views/ExerciseDetailView.swift
  </files>
  <action>
    1. **Add startInEditMode parameter to MuscleWeightEditorView:**
       - Add `var startInEditMode: Bool = false` parameter to MuscleWeightEditorView
       - In `.onAppear`, if `startInEditMode` is true, set `viewModel.isEditing = true`
       - This keeps backward compatibility (default is false for any other callers)

    2. **Update ExerciseDetailView to pass startInEditMode: true:**
       - In the `.sheet(isPresented: $showingMuscleEditor)` block, add `startInEditMode: true` to the MuscleWeightEditorView init
       - Rationale: When user explicitly taps "Edit Muscle Weights" from the detail view, they want to edit -- starting in read mode with a hidden Edit button is confusing

    3. **Verify MuscleWeightViewModel.isEditing default remains false:**
       - The VM default (`isEditing = false`) stays. Only the view overrides this on appear when startInEditMode is true.
       - This means the creation wizard flow (step 4) can also pass startInEditMode: true to skip the friction. Check if ExerciseCreationWizard uses MuscleWeightEditorView -- if so, pass startInEditMode: true there too.
  </action>
  <verify>
    Build succeeds: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 17 Pro' build`
  </verify>
  <done>
    MuscleWeightEditorView accepts startInEditMode parameter. ExerciseDetailView passes true. Sliders are immediately interactive when opened from detail view.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create custom exercise edit view</name>
  <files>
    GymAnals/Features/ExerciseLibrary/Views/CustomExerciseEditView.swift
    GymAnals/Features/ExerciseLibrary/Views/ExerciseDetailView.swift
  </files>
  <action>
    1. **Create CustomExerciseEditView.swift** in Features/ExerciseLibrary/Views/:
       - A Form-based edit view (NOT a wizard) since the exercise already exists
       - Properties:
         - `@Environment(\.modelContext) private var modelContext`
         - `@Environment(\.dismiss) private var dismiss`
         - `let exercise: Exercise` (the exercise to edit)
         - `@State private var displayName: String` (init from exercise.displayName)
         - `@State private var notes: String` (init from exercise.notes)
         - `@State private var restDuration: TimeInterval` (init from exercise.restDuration)
         - `@State private var autoStartTimer: Bool` (init from exercise.autoStartTimer)
         - `@State private var selectedEquipment: Equipment?` (init from exercise.equipment)
         - `@State private var selectedMovement: Movement?` (init from exercise.movement)
       - Form sections:
         a. **Name section:** TextField for displayName
         b. **Classification section:**
            - Equipment picker (NavigationLink to a list of all Equipment via @Query)
            - Movement picker (NavigationLink to a list of all Movement via @Query)
         c. **Timer Settings section:**
            - Stepper for rest duration (30-300 seconds, step 15)
            - Toggle for auto-start timer
         d. **Notes section:** TextEditor for notes
       - Toolbar:
         - Cancel button (placement: .cancellationAction) that dismisses
         - Save button (placement: .confirmationAction) that saves changes to exercise and dismisses
       - Save logic:
         ```swift
         exercise.displayName = displayName
         exercise.notes = notes
         exercise.restDuration = restDuration
         exercise.autoStartTimer = autoStartTimer
         exercise.equipment = selectedEquipment
         exercise.movement = selectedMovement
         try? modelContext.save()
         dismiss()
         ```
       - Use `init(exercise:)` that reads current values into @State vars
       - Do NOT include muscle weights here (that has its own dedicated editor)
       - Do NOT include dimensions editing (keep it simple for v1 -- dimensions are set at creation)

    2. **Add Edit button to ExerciseDetailView:**
       - Add `@State private var showingEditSheet = false`
       - In the toolbar, add an "Edit" button ONLY when `!exercise.isBuiltIn`
       - The existing favorite star button stays. Add the edit button as a second ToolbarItem or use a Menu to group them:
         ```swift
         ToolbarItem(placement: .primaryAction) {
             HStack(spacing: 16) {
                 if !exercise.isBuiltIn {
                     Button("Edit") { showingEditSheet = true }
                 }
                 Button { exercise.isFavorite.toggle(); try? modelContext.save() } label: {
                     Image(systemName: exercise.isFavorite ? "star.fill" : "star")
                         .foregroundStyle(exercise.isFavorite ? .yellow : .gray)
                 }
             }
         }
         ```
       - Add `.sheet(isPresented: $showingEditSheet) { NavigationStack { CustomExerciseEditView(exercise: exercise) } }`

    3. **Equipment/Movement picker subviews inside CustomExerciseEditView:**
       - For equipment selection: Use a simple List with @Query for all Equipment sorted by displayName. Tap to select and pop back via NavigationLink.
       - For movement selection: Use a simple List with @Query for all Movement sorted by displayName. Tap to select and pop back via NavigationLink.
       - These can be inline private subviews or NavigationLink destinations within the Form.
  </action>
  <verify>
    Build succeeds: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 17 Pro' build`
  </verify>
  <done>
    CustomExerciseEditView exists with Form-based editing for name, equipment, movement, timer settings, and notes. ExerciseDetailView shows Edit button for custom exercises. Built-in exercises show no Edit button.
  </done>
</task>

</tasks>

<verification>
- Build compiles without errors
- MuscleWeightEditorView accepts startInEditMode parameter
- CustomExerciseEditView.swift exists with Form layout
- ExerciseDetailView has Edit button (custom) and no Edit button (built-in)
- Equipment and movement pickers work in the edit form
</verification>

<success_criteria>
1. SC5: Muscle weight sliders are immediately interactive when opened from exercise detail view
2. SC6: Custom exercises have full edit form (name, equipment, movement, timer settings, notes)
3. Built-in exercises remain read-only with no edit option
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes/06-02-SUMMARY.md`
</output>
