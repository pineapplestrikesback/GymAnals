---
phase: 06-bug-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - GymAnals/Features/Workout/Views/SetRowView.swift
  - GymAnals/Features/Workout/Views/ExerciseSectionView.swift
autonomous: true

must_haves:
  truths:
    - "Each exercise section shows column headers: SET | PREVIOUS | KG | REPS above the set rows"
    - "Each set row shows previous workout data inline in a PREVIOUS column (e.g., '100 x 8')"
    - "The layout matches the Hevy-style: set number, previous, weight input, reps input, checkmark"
  artifacts:
    - path: "GymAnals/Features/Workout/Views/SetRowView.swift"
      provides: "Hevy-style column layout with inline PREVIOUS column"
      contains: "previousText"
    - path: "GymAnals/Features/Workout/Views/ExerciseSectionView.swift"
      provides: "Column header row above set list"
      contains: "PREVIOUS"
  key_links:
    - from: "ExerciseSectionView.swift"
      to: "SetRowView.swift"
      via: "column header alignment matches set row columns"
      pattern: "SET.*PREVIOUS.*REPS"
---

<objective>
Restructure set logging layout to Hevy-style columns with inline previous workout data.

Purpose: The current layout shows previous values as small "last: X" hint text below each row, requiring vertical scanning. The Hevy-style layout puts PREVIOUS as a dedicated column inline with the set data, enabling instant side-by-side comparison. This is the most-requested UX improvement for workout logging.
Output: Column-based set layout with headers and inline previous data.
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-bug-fixes/06-RESEARCH.md

@GymAnals/Features/Workout/Views/SetRowView.swift
@GymAnals/Features/Workout/Views/ExerciseSectionView.swift
@GymAnals/Features/Workout/Components/StepperTextField.swift
@GymAnals/Features/Workout/Components/SetTimerBadge.swift
@GymAnals/Models/Enums/WeightUnit.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure SetRowView to Hevy-style column layout</name>
  <files>
    GymAnals/Features/Workout/Views/SetRowView.swift
  </files>
  <action>
    Restructure SetRowView from the current layout:
    ```
    [#] [reps input] x [weight input] [unit] ... [timer] [checkmark]
    last: 8                  last: 95
    ```

    To the Hevy-style column layout:
    ```
    [#] [PREVIOUS]  [WEIGHT input] [REPS input] [checkmark]
    ```

    Specific changes:

    1. **Remove the old hint row entirely:**
       - Delete the entire `if previousReps != nil || previousWeight != nil { ... }` VStack block that shows "last: X" text below the inputs
       - The VStack wrapper around the main HStack and hint row can be simplified to just the HStack

    2. **Restructure the main HStack to this column order:**
       ```swift
       HStack(spacing: 0) {
           // Set number
           Text("\(setNumber)")
               .font(.headline)
               .foregroundStyle(.secondary)
               .frame(width: 32, alignment: .center)

           // PREVIOUS column (read-only)
           Text(previousText)
               .font(.subheadline)
               .foregroundStyle(.tertiary)
               .frame(width: 80, alignment: .center)

           // WEIGHT input (with stepper when focused)
           weightInputView
               .frame(minWidth: 50)

           // REPS input (with stepper when focused)
           repsInputView
               .frame(minWidth: 50)

           // Confirm checkmark
           Button { onConfirm() } label: {
               Image(systemName: isConfirmed ? "checkmark.circle.fill" : "circle")
                   .font(.title2)
                   .foregroundStyle(isConfirmed ? .green : .secondary)
           }
           .buttonStyle(.plain)
           .frame(width: 36, alignment: .center)
       }
       ```

    3. **Add previousText computed property:**
       ```swift
       private var previousText: String {
           if let w = previousWeight, let r = previousReps {
               return "\(formatWeight(w)) x \(r)"
           } else if let w = previousWeight {
               return "\(formatWeight(w))"
           } else if let r = previousReps {
               return "\(r) reps"
           }
           return "-"
       }
       ```

    4. **Remove the "x" Text between reps and weight** -- column layout doesn't need it since headers label the columns.

    5. **Remove the weight unit abbreviation text** -- include it in the column header instead.

    6. **Remove the timer badge from the set row** -- the timer is now always visible in the workout header (Plan 04 handles this). For now, if the timer badge is still used, keep it but place it less prominently (or remove it since SC9 moves timer to the always-visible header).
       - Decision: Remove `SetTimerBadge` from the set row. Timer visibility moves to the header. This simplifies the row layout.
       - Remove the `timer` and `onTimerTap` parameters from SetRowView (they'll be unused).
       - Update all callers (ExerciseSectionView's setRowWithSwipe) to remove timer-related params.

    7. **Keep the stepper +/- button behavior** -- it still expands when focused. Adjust frame widths so columns stay aligned even when steppers appear.

    8. **Update the preview** at the bottom to reflect the new parameter signature.
  </action>
  <verify>
    Build succeeds: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 16' build`
  </verify>
  <done>
    SetRowView displays: [SET #] [PREVIOUS] [WEIGHT] [REPS] [CHECKMARK] in a clean column layout. Previous workout data is inline. Timer badge removed from row. No hint text below rows.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add column headers to ExerciseSectionView</name>
  <files>
    GymAnals/Features/Workout/Views/ExerciseSectionView.swift
  </files>
  <action>
    1. **Add a column header row** above the sets list (inside the expandable content, before the ForEach):
       ```swift
       // Column headers
       HStack(spacing: 0) {
           Text("SET")
               .frame(width: 32, alignment: .center)
           Text("PREVIOUS")
               .frame(width: 80, alignment: .center)
           Text(weightUnit.abbreviation.uppercased())
               .frame(minWidth: 50)
           Text("REPS")
               .frame(minWidth: 50)
           Spacer()
               .frame(width: 36) // Checkmark column spacer
       }
       .font(.caption2)
       .foregroundStyle(.tertiary)
       .padding(.horizontal, 8)
       .padding(.top, 8)
       .padding(.bottom, 4)
       ```
       - The column widths MUST match SetRowView's column widths for alignment
       - Use the weightUnit passed to ExerciseSectionView for the weight column header (KG or LBS)

    2. **Add weightUnit parameter to ExerciseSectionView** if not already present (check -- it already has `let weightUnit: WeightUnit`).

    3. **Update setRowWithSwipe to remove timer-related params** since Task 1 removed them from SetRowView:
       - Remove `timer: timerForSet(workoutSet)` from SetRowView init
       - Remove `onTimerTap` closure from SetRowView init
       - Remove `let timerForSet: (WorkoutSet) -> SetTimer?` and `let onTimerTap: (SetTimer) -> Void` from ExerciseSectionView properties IF they are only used for SetRowView. Check if they're used elsewhere -- if not, remove them.
       - Note: The timer tap is still handled at the header level in ActiveWorkoutView, so ExerciseSectionView no longer needs timer props passed just for set rows.

    4. **Update ExerciseSectionView callers** -- specifically `ExerciseSectionForID` in ActiveWorkoutView.swift. Remove timer-related closures that are no longer needed. BUT be careful: only remove what's no longer needed. ActiveWorkoutView.swift is NOT in this plan's files_modified. If removing timerForSet/onTimerTap from ExerciseSectionView causes ActiveWorkoutView to fail to compile, we need to also update ActiveWorkoutView. Add it to the modified files.
       - Actually, since we're removing params from ExerciseSectionView that ActiveWorkoutView currently passes, we MUST update ActiveWorkoutView too to remove those params from the call site.
       - Update `ExerciseSectionForID` in ActiveWorkoutView.swift to stop passing `timerForSet` and `onTimerTap` to ExerciseSectionView.

    5. **Update the preview** if ExerciseSectionView has one.
  </action>
  <verify>
    Build succeeds: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 16' build`
  </verify>
  <done>
    Column headers (SET, PREVIOUS, KG/LBS, REPS) display above set rows in each exercise section. Headers align with SetRowView columns. Timer-related props cleaned up from set row pipeline.
  </done>
</task>

</tasks>

<verification>
- Build compiles without errors
- SetRowView shows inline PREVIOUS column
- ExerciseSectionView shows column headers
- Column widths match between headers and rows
- No timer badge in individual set rows
- Previous "last: X" hint row removed
</verification>

<success_criteria>
1. SC8: Set logging layout shows Hevy-style columns: SET | PREVIOUS | WEIGHT | REPS | checkmark
2. Previous workout data displays inline in the PREVIOUS column (e.g., "100 x 8")
3. Column headers visible above each exercise's set list
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes/06-03-SUMMARY.md`
</output>
