---
phase: 04-workout-logging
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - GymAnals/Features/Workout/Components/StepperTextField.swift
  - GymAnals/Features/Workout/Components/SetTimerBadge.swift
  - GymAnals/Features/Workout/Views/SetRowView.swift
  - GymAnals/Features/Workout/Models/SetEntryField.swift
autonomous: true

must_haves:
  truths:
    - "User can tap +/- to adjust reps and weight"
    - "User can tap field to type directly"
    - "Previous workout values show as hint below each field"
    - "Checkmark button confirms and logs the set"
  artifacts:
    - path: "GymAnals/Features/Workout/Components/StepperTextField.swift"
      provides: "Reusable stepper with text input"
      contains: "struct StepperTextField"
    - path: "GymAnals/Features/Workout/Views/SetRowView.swift"
      provides: "Individual set entry row"
      contains: "struct SetRowView"
    - path: "GymAnals/Features/Workout/Components/SetTimerBadge.swift"
      provides: "Timer countdown badge"
      contains: "Timer.publish"
  key_links:
    - from: "SetRowView"
      to: "@FocusState"
      via: "SetEntryField enum binding"
      pattern: "@FocusState.*SetEntryField"
---

<objective>
Create the set entry UI components including stepper inputs, timer badges, and the complete set row with previous value hints.

Purpose: Fast set logging (under 10 seconds per set) requires optimized input. The stepper + tap-to-type combo provides quick adjustment and keyboard entry. Previous value hints reduce cognitive load.

Output: StepperTextField reusable component, SetTimerBadge for countdown display, SetRowView combining all elements, and SetEntryField enum for focus management.
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-workout-logging/04-CONTEXT.md
@.planning/phases/04-workout-logging/04-RESEARCH.md
@.planning/phases/04-workout-logging/04-01-SUMMARY.md
@.planning/phases/04-workout-logging/04-02-SUMMARY.md
@GymAnals/Models/Core/WorkoutSet.swift
@GymAnals/Models/Enums/WeightUnit.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SetEntryField enum and StepperTextField component</name>
  <files>
    GymAnals/Features/Workout/Models/SetEntryField.swift
    GymAnals/Features/Workout/Components/StepperTextField.swift
  </files>
  <action>
Create SetEntryField.swift - focus state enum:
```swift
enum SetEntryField: Hashable {
    case reps(setID: UUID)
    case weight(setID: UUID)
}
```

Create StepperTextField.swift - reusable component:
- Binding<Double> for value
- `step: Double` for increment/decrement amount
- `range: ClosedRange<Double>` for validation
- `unit: String` for display (e.g., "kg", "reps")
- `onFocus: () -> Void` optional callback

Layout: [- button] [TextField] [unit label] [+ button]
- Minus button decreases value by step (clamped to range.lowerBound)
- Plus button increases value by step (clamped to range.upperBound)
- TextField shows formatted value (no decimals if whole number, one decimal otherwise)
- Use .keyboardType(.decimalPad)
- Use @FocusState internally for focus tracking
- Add sensoryFeedback(.decrease/.increase) on value change via buttons
- On focus: format value in textValue, call onFocus
- On blur: parse textValue, clamp to range, update binding

Button styling: 32x32 frame, .regularMaterial Circle background, system minus/plus images.
  </action>
  <verify>Build succeeds. StepperTextField renders with +/- buttons and editable field.</verify>
  <done>SetEntryField enum enables @FocusState management across sets. StepperTextField provides tap-to-adjust and keyboard input with haptic feedback.</done>
</task>

<task type="auto">
  <name>Task 2: Create SetTimerBadge component</name>
  <files>
    GymAnals/Features/Workout/Components/SetTimerBadge.swift
  </files>
  <action>
Create SetTimerBadge.swift:
- Takes `timer: SetTimer` and `onTap: () -> Void`
- Uses Timer.publish(every: 1, on: .main, in: .common).autoconnect() for updates
- @State private var remainingSeconds: Int
- onReceive(updateTimer) updates remainingSeconds from timer.remainingSeconds
- onAppear sets initial remainingSeconds

Display format: "M:SS" (e.g., "2:00", "1:45", "0:30")
- Use .monospacedDigit() font modifier for stable width
- Capsule background with .orange.opacity(0.2)
- .caption font
- Button wrapping the content, .buttonStyle(.plain)

Helper function formatTime(_ seconds: Int) -> String:
- Calculate minutes and seconds
- Return String(format: "%d:%02d", mins, secs)
  </action>
  <verify>Build succeeds. Badge displays countdown updating every second.</verify>
  <done>SetTimerBadge shows countdown derived from SetTimer's Date-based endTime, updating via Timer.publish.</done>
</task>

<task type="auto">
  <name>Task 3: Create SetRowView component</name>
  <files>
    GymAnals/Features/Workout/Views/SetRowView.swift
  </files>
  <action>
Create SetRowView.swift:
```swift
struct SetRowView: View {
    let setNumber: Int
    @Binding var reps: Int
    @Binding var weight: Double
    let previousReps: Int?
    let previousWeight: Double?
    let weightUnit: WeightUnit
    let timer: SetTimer?  // Per-set timer if active
    let onConfirm: () -> Void
    let onTimerTap: () -> Void

    @FocusState.Binding var focusedField: SetEntryField?
    let setID: UUID
}
```

Layout (HStack):
1. Set number label (24pt width, .secondary, .headline font)
2. Reps section (VStack):
   - TextField for reps with numberPad, focused binding to .reps(setID:)
   - "last: X" hint below if previousReps exists (.caption2, .tertiary)
3. "x" separator (.secondary)
4. Weight section (VStack):
   - HStack: TextField + unit abbreviation, focused binding to .weight(setID:)
   - "last: X" hint below if previousWeight exists (.caption2, .tertiary)
5. Spacer
6. Timer badge if timer exists (SetTimerBadge, onTap: onTimerTap)
7. Confirm button (checkmark.circle.fill, .title2, .green, onTap: onConfirm)

TextField styling:
- .textFieldStyle(.roundedBorder)
- .multilineTextAlignment(.center)
- Frame widths: reps ~50pt, weight ~60pt

Use value: $reps with format: .number for reps (Int binding)
Use value: $weight with format: .number for weight (Double binding)
  </action>
  <verify>Build succeeds. SetRowView shows set number, inputs with hints, optional timer, and confirm button.</verify>
  <done>SetRowView provides complete set entry with previous value hints, @FocusState navigation, per-set timer badge, and confirm action.</done>
</task>

</tasks>

<verification>
1. Build succeeds: `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 16' build`
2. StepperTextField +/- buttons adjust value with haptic feedback
3. StepperTextField tap-to-type works with keyboard
4. SetTimerBadge countdown updates every second
5. SetRowView displays all elements with correct layout
6. @FocusState binding allows programmatic focus control
</verification>

<success_criteria>
- Set entry is fast: tap +/- or tap to type
- Previous values show as hints: "last: 8" under reps, "last: 100" under weight
- Per-set timer badge visible when timer active
- Confirm button prominent and easy to tap
- Focus can be programmatically moved between fields
</success_criteria>

<output>
After completion, create `.planning/phases/04-workout-logging/04-03-SUMMARY.md`
</output>
