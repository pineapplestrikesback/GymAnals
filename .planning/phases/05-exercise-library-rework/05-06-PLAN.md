---
phase: 05-exercise-library-rework
plan: 06
type: execute
wave: 4
depends_on:
  - "05"
files_modified:
  - GymAnals/Models/Core/Variant.swift
  - GymAnals/Models/Core/VariantMuscle.swift
  - GymAnals/Services/Persistence/PersistenceController.swift
autonomous: true

must_haves:
  truths:
    - "Variant.swift file is deleted"
    - "VariantMuscle.swift file is deleted"
    - "PersistenceController schema does not include Variant or VariantMuscle"
  artifacts:
    - path: "GymAnals/Services/Persistence/PersistenceController.swift"
      provides: "Updated schema without Variant models"
      contains: "Movement.self"
  key_links:
    - from: "PersistenceController.swift"
      to: "Exercise.swift"
      via: "schema registration"
      pattern: "Exercise.self"
---

<objective>
Remove the Variant and VariantMuscle models from the codebase and update PersistenceController.

Purpose: Clean up deprecated models after Exercise refactoring.
Output: Codebase without Variant-based models, updated persistence schema.
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-exercise-library-rework/05-CONTEXT.md
@.planning/phases/05-exercise-library-rework/05-RESEARCH.md
@GymAnals/Services/Persistence/PersistenceController.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete Variant and VariantMuscle files</name>
  <files>
    GymAnals/Models/Core/Variant.swift
    GymAnals/Models/Core/VariantMuscle.swift
  </files>
  <action>
Delete the following files from the project:
1. GymAnals/Models/Core/Variant.swift
2. GymAnals/Models/Core/VariantMuscle.swift

Also remove them from the Xcode project file if necessary (they should be automatically removed when deleted from filesystem if using file references).

Note: These models are no longer used since Exercise now has:
- dimensions: Dimensions (replaces variant reference)
- muscleWeights: [String: Double] (replaces VariantMuscle relationship)
- movement: Movement? (direct relationship, not via Variant)
  </action>
  <verify>
Files no longer exist on filesystem. Run `ls GymAnals/Models/Core/` to confirm Variant.swift and VariantMuscle.swift are gone.
  </verify>
  <done>
Variant.swift and VariantMuscle.swift deleted from project.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update PersistenceController schema</name>
  <files>
    GymAnals/Services/Persistence/PersistenceController.swift
  </files>
  <action>
Update PersistenceController.swift to remove Variant and VariantMuscle from the schema:

```swift
import Foundation
import SwiftData

@MainActor
final class PersistenceController {
    static let shared = PersistenceController()

    let schema: Schema
    let modelConfiguration: ModelConfiguration

    private init() {
        schema = Schema([
            Movement.self,
            Equipment.self,
            Exercise.self,
            Gym.self,
            Workout.self,
            WorkoutSet.self,
            ExerciseWeightHistory.self
        ])
        // Note: Variant.self and VariantMuscle.self REMOVED

        // User data stored in app's Application Support directory
        let storeURL = URL.applicationSupportDirectory
            .appending(path: "GymAnals")
            .appending(path: "userdata.store")

        modelConfiguration = ModelConfiguration(
            "GymAnals",
            schema: schema,
            url: storeURL,
            allowsSave: true
        )
    }

    func createContainer() throws -> ModelContainer {
        // Ensure directory exists
        let directory = URL.applicationSupportDirectory.appending(path: "GymAnals")
        try FileManager.default.createDirectory(
            at: directory,
            withIntermediateDirectories: true
        )

        return try ModelContainer(
            for: schema,
            configurations: modelConfiguration
        )
    }

    /// For SwiftUI previews - uses in-memory storage
    static var preview: ModelContainer {
        let schema = Schema([
            Movement.self,
            Equipment.self,
            Exercise.self,
            Gym.self,
            Workout.self,
            WorkoutSet.self,
            ExerciseWeightHistory.self
        ])
        // Note: Variant.self and VariantMuscle.self REMOVED

        let config = ModelConfiguration(isStoredInMemoryOnly: true)

        do {
            return try ModelContainer(for: schema, configurations: config)
        } catch {
            fatalError("Failed to create preview container: \(error)")
        }
    }
}
```

Changes:
1. Remove Variant.self from both schema arrays
2. Remove VariantMuscle.self from both schema arrays
3. Keep all other models unchanged

NOTE: Removing models from schema will cause data loss for any existing Variant/VariantMuscle data.
For a fresh install, this is fine. For existing users, a migration would be needed (out of scope for this phase).
  </action>
  <verify>
Build project - should compile. Verify PersistenceController no longer references Variant or VariantMuscle.
  </verify>
  <done>
PersistenceController updated with schema excluding Variant and VariantMuscle.
  </done>
</task>

</tasks>

<verification>
1. `ls GymAnals/Models/Core/Variant.swift` returns "No such file or directory"
2. `ls GymAnals/Models/Core/VariantMuscle.swift` returns "No such file or directory"
3. `grep -r "Variant.self" GymAnals/Services/Persistence/` returns no matches
4. `grep -r "VariantMuscle.self" GymAnals/Services/Persistence/` returns no matches
5. PersistenceController.swift lists exactly 7 models in schema

Note: Remaining Variant references in views/viewmodels are fixed by downstream plans (05-07 removes ExerciseSeedService, 05-09 updates creation wizard, 05-10 updates library views).
</verification>

<success_criteria>
- Variant.swift and VariantMuscle.swift files deleted
- PersistenceController schema updated without deprecated models
- No Variant.self or VariantMuscle.self in PersistenceController

Note: Full compilation requires downstream plans (05-07, 05-09, 05-10) to update remaining references.
</success_criteria>

<output>
After completion, create `.planning/phases/05-exercise-library-rework/05-06-SUMMARY.md`
</output>
