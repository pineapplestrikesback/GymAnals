---
phase: 05-exercise-library-rework
plan: 08
type: execute
wave: 5
depends_on:
  - "07"
files_modified:
  - GymAnals/Resources/movements.json
  - GymAnals/Resources/equipment.json
  - GymAnals/Resources/presets_all.json
  - GymAnals/App/GymAnalsApp.swift
autonomous: true

must_haves:
  truths:
    - "movements.json is in app bundle Resources"
    - "equipment.json is in app bundle Resources"
    - "presets_all.json is in app bundle Resources"
    - "GymAnalsApp calls all seed services in correct order"
    - "App launches without crashing"
  artifacts:
    - path: "GymAnals/App/GymAnalsApp.swift"
      provides: "App entry point with seeding"
      contains: "PresetSeedService.seedIfNeeded"
  key_links:
    - from: "GymAnalsApp.swift"
      to: "PresetSeedService.swift"
      via: "seedIfNeeded call"
      pattern: "PresetSeedService.seedIfNeeded"
---

<objective>
Copy JSON resources to app bundle and update app initialization to use new seed services.

Purpose: Wire up seeding of 30 movements, 22 equipment types, and 237 exercise presets on first launch.
Output: App seeding 237 exercises from research data on first launch.
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-exercise-library-rework/05-CONTEXT.md
@GymAnals/App/GymAnalsApp.swift
@exercise_library_refactor/movements.json
@exercise_library_refactor/equipment.json
@exercise_library_refactor/presets_all.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy JSON files to Resources folder</name>
  <files>
    GymAnals/Resources/movements.json
    GymAnals/Resources/equipment.json
    GymAnals/Resources/presets_all.json
  </files>
  <action>
Create GymAnals/Resources/ folder if it doesn't exist.

Copy the following files from exercise_library_refactor/ to GymAnals/Resources/:
1. movements.json
2. equipment.json
3. presets_all.json

Ensure files are added to the Xcode project target (GymAnals) so they're included in the app bundle.
In Xcode, the files should appear in "Copy Bundle Resources" build phase.

If there's an existing exercises.json in Resources, delete it (it used the old Variant-based format).
  </action>
  <verify>
Files exist in GymAnals/Resources/. Check with `ls GymAnals/Resources/*.json`.
  </verify>
  <done>
Three JSON files copied to Resources folder and ready for bundle inclusion.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update GymAnalsApp to use new seed services</name>
  <files>
    GymAnals/App/GymAnalsApp.swift
  </files>
  <action>
Update GymAnalsApp.swift to call the new seed services in correct order:

```swift
import SwiftUI
import SwiftData

@main
struct GymAnalsApp: App {
    let container: ModelContainer

    init() {
        do {
            container = try PersistenceController.shared.createContainer()

            // Seed database on first launch
            // Order matters: Equipment and Movement must exist before Presets
            let context = container.mainContext
            GymSeedService.seedIfNeeded(context: context)
            EquipmentSeedService.seedIfNeeded(context: context)
            MovementSeedService.seedIfNeeded(context: context)
            PresetSeedService.seedIfNeeded(context: context)
        } catch {
            fatalError("Failed to initialize SwiftData: \(error.localizedDescription)")
        }
    }

    var body: some Scene {
        WindowGroup {
            ContentView()
        }
        .modelContainer(container)
    }
}
```

Key changes:
1. Remove ExerciseSeedService.seedIfNeeded() call
2. Add EquipmentSeedService.seedIfNeeded() call
3. Add MovementSeedService.seedIfNeeded() call
4. Add PresetSeedService.seedIfNeeded() call
5. Keep GymSeedService.seedIfNeeded() at the start

Order is critical:
1. GymSeedService - creates default gym (no dependencies)
2. EquipmentSeedService - creates 22 equipment (no dependencies)
3. MovementSeedService - creates 30 movements (no dependencies)
4. PresetSeedService - creates 237 exercises (requires Movement and Equipment to exist)
  </action>
  <verify>
Build and run app in simulator. Check console for seed service output messages showing expected counts.
  </verify>
  <done>
GymAnalsApp updated to call all seed services in correct order.
  </done>
</task>

<task type="auto">
  <name>Task 3: Delete old exercises.json if exists</name>
  <files>
    GymAnals/Resources/exercises.json (if exists)
  </files>
  <action>
Check if GymAnals/Resources/exercises.json exists. If so, delete it as it uses the old Variant-based format and is no longer needed.

Also check if exercises.json exists anywhere else in the project (root, bundle, etc.) and remove it.
  </action>
  <verify>
No exercises.json file exists in the project.
  </verify>
  <done>
Old exercises.json removed if it existed.
  </done>
</task>

</tasks>

<verification>
1. Run `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 16' build` - exits with code 0
2. `ls GymAnals/Resources/` shows movements.json, equipment.json, presets_all.json
3. GymAnalsApp.swift contains all four seed service calls
4. Run app in simulator - console shows:
   - "GymSeedService: Seeded default gym"
   - "EquipmentSeedService: Seeded 22 equipment types"
   - "MovementSeedService: Seeded 30 movements"
   - "PresetSeedService: Seeded 237 exercise presets"
5. App launches without crashing
</verification>

<success_criteria>
- All JSON files in app bundle
- App initializes and calls all seed services
- Console shows correct seed counts
- No crashes on fresh launch
- Old exercises.json removed
</success_criteria>

<output>
After completion, create `.planning/phases/05-exercise-library-rework/05-08-SUMMARY.md`
</output>
