---
phase: 05-exercise-library-rework
plan: 04
type: execute
wave: 2
depends_on:
  - "01"
files_modified:
  - GymAnals/Models/Core/Movement.swift
autonomous: true

must_haves:
  truths:
    - "Movement model has id as String (not UUID)"
    - "Movement model has categoryRaw and subcategory properties"
    - "Movement model has defaultMuscleWeights dictionary"
    - "Movement model has applicableDimensions and applicableEquipment"
    - "Project compiles after Movement update"
  artifacts:
    - path: "GymAnals/Models/Core/Movement.swift"
      provides: "Updated Movement model with category and defaults"
      contains: "var defaultMuscleWeights: [String: Double]"
  key_links:
    - from: "Movement.swift"
      to: "MovementCategory.swift"
      via: "categoryRaw stored property"
      pattern: "var categoryRaw: String"
    - from: "Movement.swift"
      to: "Exercise.swift"
      via: "@Relationship cascade"
      pattern: "@Relationship.*deleteRule.*cascade.*exercises"
---

<objective>
Update the Movement model to support the new data schema with categories and default muscle weights.

Purpose: Enable Movement to store category, applicable dimensions/equipment, and default muscle weights from movements.json.
Output: Updated Movement model ready for seeding 30 movement patterns.
</objective>

<execution_context>
@/Users/opera_user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/opera_user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-exercise-library-rework/05-CONTEXT.md
@.planning/phases/05-exercise-library-rework/05-RESEARCH.md
@GymAnals/Models/Core/Movement.swift
@GymAnals/Models/Enums/MovementCategory.swift
@exercise_library_refactor/movements.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Movement model with new properties</name>
  <files>
    GymAnals/Models/Core/Movement.swift
  </files>
  <action>
Update Movement.swift to match the new schema. Note: Remove the `variants` relationship since Variant model will be removed.

```swift
import Foundation
import SwiftData

/// Base movement pattern (e.g., "Bench Press", "Squat", "Deadlift")
/// Contains default muscle weights inherited by custom exercises
@Model
final class Movement {
    // MARK: - Identification

    /// Unique identifier - snake_case for built-in (e.g., "bench_press"), UUID string for custom
    var id: String = UUID().uuidString

    /// Display name shown in UI
    var displayName: String = ""

    // MARK: - Classification

    /// Raw value storage for SwiftData predicate filtering
    var categoryRaw: String = MovementCategory.push.rawValue

    /// Subcategory for more granular classification (e.g., "horizontal_push", "vertical_pull")
    var subcategory: String = ""

    /// Raw value storage for exercise type (weight+reps, time-based, etc.)
    var exerciseTypeRaw: Int = ExerciseType.weightReps.rawValue

    // MARK: - Dimension and Equipment Constraints

    /// Valid dimension values per dimension type (e.g., {"angle": ["flat", "incline_30"]})
    var applicableDimensions: [String: [String]] = [:]

    /// Compatible equipment IDs for this movement
    var applicableEquipment: [String] = []

    // MARK: - Default Values for Custom Exercises

    /// Default muscle weights inherited when creating custom exercises
    var defaultMuscleWeights: [String: Double] = [:]

    /// Default description for the movement pattern
    var defaultDescription: String = ""

    // MARK: - Metadata

    var notes: String = ""
    var sources: [String] = []
    var isBuiltIn: Bool = true
    var isHidden: Bool = false

    // MARK: - Relationships

    /// Exercises using this movement pattern
    @Relationship(deleteRule: .cascade, inverse: \Exercise.movement)
    var exercises: [Exercise] = []

    // MARK: - Computed Properties

    /// Type-safe access to movement category
    var category: MovementCategory {
        get { MovementCategory(rawValue: categoryRaw) ?? .push }
        set { categoryRaw = newValue.rawValue }
    }

    /// Type-safe access to exercise type
    var exerciseType: ExerciseType {
        get { ExerciseType(rawValue: exerciseTypeRaw) ?? .weightReps }
        set { exerciseTypeRaw = newValue.rawValue }
    }

    // MARK: - Initialization

    init(
        id: String? = nil,
        displayName: String,
        category: MovementCategory = .push,
        subcategory: String = "",
        exerciseType: ExerciseType = .weightReps,
        isBuiltIn: Bool = true
    ) {
        self.id = id ?? UUID().uuidString
        self.displayName = displayName
        self.categoryRaw = category.rawValue
        self.subcategory = subcategory
        self.exerciseTypeRaw = exerciseType.rawValue
        self.isBuiltIn = isBuiltIn
    }

    /// Convenience initializer for backward compatibility
    convenience init(name: String, isBuiltIn: Bool = true, exerciseType: ExerciseType = .weightReps) {
        self.init(displayName: name, exerciseType: exerciseType, isBuiltIn: isBuiltIn)
    }
}
```

Key changes from old model:
1. Changed `id` from UUID to String (for snake_case built-in IDs like "bench_press")
2. Renamed `name` to `displayName` for consistency
3. Added `categoryRaw` with computed `category` accessor (MovementCategory enum)
4. Added `subcategory` String field
5. Added `applicableDimensions: [String: [String]]` dictionary
6. Added `applicableEquipment: [String]` array
7. Added `defaultMuscleWeights: [String: Double]` dictionary
8. Added `defaultDescription`, `notes`, `sources` fields
9. REMOVED `variants` relationship (Variant model being deleted)
10. CHANGED `exercises` relationship - now direct (Exercise has movement reference)
11. Added convenience init for backward compatibility

IMPORTANT: The `exercises` relationship inverse expects Exercise.movement to exist. This will be added in plan 05-05.
  </action>
  <verify>
Build project - may have temporary compile error for Exercise.movement until plan 05-05 runs. If so, temporarily comment out the @Relationship line and note for plan 05-05 to uncomment.
  </verify>
  <done>
Movement model updated with String id, displayName, category, defaultMuscleWeights, and dimension/equipment constraints. Variant relationship removed.
  </done>
</task>

</tasks>

<verification>
1. Run `xcodebuild -scheme GymAnals -destination 'platform=iOS Simulator,name=iPhone 16' build` - may need temporary adjustments
2. Movement.swift contains "var id: String"
3. Movement.swift contains "var categoryRaw: String"
4. Movement.swift contains "var defaultMuscleWeights: [String: Double]"
5. Movement.swift contains "var applicableDimensions: [String: [String]]"
6. Movement.swift does NOT contain "variants: [Variant]"
7. Movement.swift contains convenience init with (name:isBuiltIn:exerciseType:) signature
</verification>

<success_criteria>
- Movement model compiles with all new properties
- String-based id allows snake_case identifiers for built-in movements
- Category and exerciseType use rawValue storage pattern
- Dictionary properties for defaultMuscleWeights and applicableDimensions
- Variant relationship removed
- Existing code continues to compile via convenience initializer
</success_criteria>

<output>
After completion, create `.planning/phases/05-exercise-library-rework/05-04-SUMMARY.md`
</output>
